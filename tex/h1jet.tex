\documentclass[12pt,a4wide]{article}

\usepackage[dvipsnames]{xcolor}
\usepackage{a4wide,amsmath,amssymb,graphicx,color}

\usepackage{listings,enumitem,calc,hyperref,caption,mmacells} 
\lstset{basicstyle=\small\ttfamily,breaklines=true,breakatwhitespace=true}

\definecolor{comment}{rgb}{0,0.3,0}
\lstset{language=Fortran}
\lstset{
  columns=flexible,
  basicstyle=\tt\footnotesize,
  keywordstyle=,
  identifierstyle=\color{black},
  commentstyle=\tt\color{comment},
  mathescape=false,
  escapebegin=\color{comment},
  showstringspaces=false,
  keepspaces=true
}

\title{H1jet, a fast program to compute transverse momentum distributions}


\begin{document}

\maketitle

\abstract{We present a fast code that computes the differential
  distribution of one of the final-state particles produced in a
  $2\to 2$ process.}

\section{Introduction}
\label{sec:intro}

\section{The method}
\label{sec:method}
Before explaining how the H1jet method works, it is instructive to
consider first how to compute the Born cross section for producing a
colour singlet $X$, e.g.\ a Higgs, of mass $m_X$. This will also allow
us to set the notation for the rest of the paper. We consider the
$2\to 1$ process $p_1 p_2 \to X$, where $p_1,p_2$ are the two incoming
partons and $p_X$ is the momentum of the considered colour
singlet. From momentum conservation we have of course
\begin{equation}
  \label{eq:mom-conservation}
  \hat s = (p_1+p_2)^2=m_X^2\,.
\end{equation}
There can be various partonic subprocesses that can contribute to the
production of the particle $X$. Let us denote with $M_{ij}$ the
amplitude for the subprocess $ij\to X$ (e.g. $gg \to H$), with
$i,j=g,q_f,\bar q_{\bar f}$, where $f,\bar f$ denotes quark (or
antiquark) flavours. The Born partonic cross section for each
subprocess is
\begin{equation}
  \label{eq:Born-xsct}
  \hat\sigma_{ij}=\frac{\pi}{m_X^2} |M_{ij}(m_X^2)|^2 \delta\left(\hat s-m_X^2\right)\,.
\end{equation}
The corresponding hadronic cross section is given by
\begin{equation}
  \label{eq:Born-had}
  \begin{split}
  \sigma& =\frac{\pi}{m_X^2}\sum_{i,j} \int_0^1 dx_1\, f_{i/p}(x_1,\mu_F)\int_0^1 dx_2 \, f_{i/p}(x_1,\mu_F)\sum_{i,j}
 |M_{ij}(m_X^2)|^2 \delta\left(x_1 x_2 s-m_X^2\right)\\
   & = \frac{\pi}{m_X^4} \sum_{i,j} |M_{ij}(m_X^2)|^2 \mathcal{L}_{ij}\left(\frac{m_X^2}{s},\mu_F\right)
  \,,
    \end{split}
\end{equation}
where $\mathcal{L}_{ij}\left(\tau,\mu_F\right)$ is the partonic luminosity
\begin{equation}
  \label{eq:hoppet-lumi}
  \mathcal{L}_{ij}\left(\tau,\mu_F\right) = \tau \int_\tau^1 \frac{dx}{x}\, f_{i/p}(x,\mu_F)\, f_{j/p}\left(\frac{\tau}{x},\mu_F\right)\,.
\end{equation}
If we are able to obtain the luminosity
$\mathcal{L}_{ij}\left(m_X^2/s,\mu_F\right)$, we are then able to
obtain a numerical prediction for the cross section from a simple
multiplication. There are indeed numerical tools that are able to
compute, tabulate and interpolate luminosities with incredible
efficiency, for instance the program
HOPPET~\cite{Salam:2008qg}. Through an interface with HOPPET, we are
able to compute the Born cross-section given the amplitudes
$M_{ij}$. This procedure is the same adopted in the program
JetVHeto~\cite{Banfi:2015pju}, that computes cross sections for colour
singlets with a veto on additional jets.

A similar strategy can be devised to obtain a fast calculation of
distribution in the transverse momentum of particle $X$. A non-zero
transverse momentum for $X$ is obtained via a generic $2\to 2$
partonic process $p_1 p_2 \to p_3 X$, where $p_1,p_2,p_3$ are massless
partons, and $p_X$ is again the momentum of the colour singlet $X$. We
wish to compute $d\sigma/dp_T$, where $p_T$ is the transverse momentum
of $p_X$ with respect to the beam axis. At Born level only, $p_T$ is
also the transverse momentum of the recoiling jet originated by
$p_3$. The partonic subprocesses contributing to $d\sigma/dp_T$ are
$gg\to g X$, $q_f \bar q_{\bar f} \to g X$, $q_f g\to q_f X$,
$gq_f \to q_fX$. The corresponding amplitudes $M_{ij}$ (with
$i,j=g,q_f,\bar q_{\bar f}$) are functions of the three Mandelstam
invariants
\begin{equation}
  \label{eq:Mandelstam}
  \begin{split}
  \hat s & = (p_1+p_2)^2 = (p_3+p_X)^2 \,,\\
  \hat t & = (p_1-p_3)^2 = (p_2-p_X)^2 \,,\\
  \hat u & = (p_2-p_3)^2 = (p_1-p_X)^2 \,.
  \end{split}
\end{equation}
Without loss of generality, in the centre-of-mass frame of the
partonic collision, we can parametrise momenta as follows
\begin{equation}
  \label{eq:momenta}
  \begin{split}
  p_1&=\frac{\sqrt s}{2}(1,0,0,1)\,,\qquad p_3 = p_T(\cosh\eta,1,0,\sinh\eta)\,,\\
  p_2&=\frac{\sqrt s}{2}(1,0,0,1)\,,\qquad p_X = (\sqrt{m_X^2+p^2_T\cosh^2\eta},-1,0,-\sinh\eta)\,,
  \end{split}
\end{equation}
so that $\eta$ is the rapidity of parton $p_3$ in the
centre-of-mass frame. The {\em partonic} $p_T$ spectrum for the
process initiated by partons $ij$ is given by
\begin{equation}
  \label{eq:partonic-pt}
  \frac{d\hat \sigma_{ij}}{dp_T} = \frac{p_T}{16\pi}\int d\eta \frac{|M_{ij}(\hat s,\hat t,\hat u)|^2}{E_X \hat s} \delta\left(\sqrt{\hat s} - p_T\cosh\eta-\sqrt{m_X^2+p^2_T\cosh^2\eta}\right)\,, 
\end{equation}
with $E_X=\sqrt{m_X^2+p^2_T\cosh^2\eta}$ the energy of the colour-singlet
particle $p_X$.  The above equation selects two values of $\eta$, as
follows
\begin{equation}
\label{eq:eta-values}
  \eta = \ln(\hat x_M \pm \sqrt{\hat x_M^2-1})\,,\qquad \hat x_M\equiv\frac{\hat s-m_X^2}{2 p_T \sqrt{\hat s} }\,.
\end{equation}
The corresponding hadronic cross section reads
\begin{equation}
\label{eq:hadronic-pt}
  \frac{d\sigma}{dp_T} = \sum_{i,j} \int_0^1 dx_1\, f_{i/p}(x_1,\mu_F)\int_0^1 dx_2 \, f_{i/p}(x_1,\mu_F) \left[\frac{d\hat \sigma_{ij}}{dp_T} \Theta(s-\hat s) \Theta\left(\hat s-p_T-\sqrt{m_X^2+p^2_T}\right)  \right]_{\hat s=x_1x_2 s}\,.
\end{equation}
Since eq.~\eqref{eq:eta-values} give two monotonic functions of $\hat s$ for $s>p_T+\sqrt{m_X^2+p^2_T}$, varying $\hat s$ in the allowed range spans all possible values of $\eta$ in the range $-\eta_M<\eta<\eta_M$ with
\begin{equation}
\label{eq:eta-range}
\eta_M \equiv \ln(x_M + \sqrt{x_M^2-1})\,,\qquad  x_M\equiv\frac{s-m_X^2}{2 p_T \sqrt{s} }\,.
\end{equation}
This allows us to integrate over $\eta$ last, and obtain, after some
manipulations,
\begin{equation}
\label{eq:hadronic-pt-lumi}
  \frac{d\sigma}{dp_T} = \frac{p_T}{8 \pi}\int_{-\eta_M}^{\eta_M}\!d\eta\, \sum_{i,j}  \left[\frac{M^2_{ij}\left(\hat s,-p_T e^{-\eta}\sqrt {\hat s}  ,- p_T e^{\eta}\sqrt{\hat s}\right)}{E_X \hat s^{3/2}}\mathcal{L}_{ij}\left(\frac{\hat s}{s},\mu_F\right) \right]_{\hat s=\left(p_T\cosh\eta+\sqrt{m_X^2+p^2_T\cosh^2\eta}\right)^2}\,,
\end{equation}
where again $\mathcal{L}_{ij}$ is the partonic luminosity for the $ij$
incoming channel as defined in eq.~\eqref{eq:hoppet-lumi}. If we are
able to obtain the partonic luminosity $\mathcal{L}_{ij}$, say, from
HOPPET, we can obtain the transverse momentum spectrum with a
one-dimensional integration, which can be performed extremely fast
with a gaussian numerical integrator.

Summarising, by interfacing HOPPET with a code that provides
amplitudes for $2\to 1$ and $2\to 2$ partonic subprocesses producing a
colour singlet $X$, we are able to perform fast computations of total
cross sections and transverse momentum spectra of $X$. In the
following sections we describe our implementation of the method for
Born processes. Note that if we are able to perform the analytic
integration over the phase space of final-state partons, the method
can also be applied to higher order cross sections and differential
spectra.

%\input{manual}

\section{User's manual} \label{sec:manual} 

This section describes the most important technical details of H1jet, including its installation and usage. 

\subsection{Installation} 
A tarball with the source files of H1jet can be obtained from ref.~\cite{h1jet}. Unpacking will result in a main directory \texttt{H1jet} with the following subdirectories: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999}, leftmargin = !]
	\item[\texttt{bin} :] contains the executable program \texttt{h1jet} after compilation, as well as the Python 3 helper scripts \texttt{PlotH1jet.py} and \texttt{DressUserAmpCode.py}. 
	\item[\texttt{src} :] source files. 
\end{description}
The \texttt{README.md} file contains information on installation and usage. \\

In the main directory, run the configure script: 
\begin{lstlisting}
	./configure [options] 
\end{lstlisting}
It will attempt to find a Fortran compiler (\texttt{gfortran} or \texttt{ifort}), as well as the dependencies on your machine. If you wish to specify a specific compiler and/or compiler flags, you can do so with the options \texttt{./configure FC=<compiler>} and \texttt{./configure FFLAGS=<flags>}. H1jet has a number of external dependencies which it must be linked to: 
\begin{itemize}
	\item LHAPDF~\cite{Buckley:2014ana}: Provides the PDF sets for H1jet. 
	\item \textsc{HOPPET}~\cite{Salam:2008qg}: For QCD DGLAP evolution of PDFs. 
	\item \textsc{Chaplin}~\cite{Buehler:2011ev}: For complex harmonic polylogarithms. 
\end{itemize} 
For the \textsc{Chaplin} library, it may be necessary to explicitly state the path to the library files with:
\begin{lstlisting}
	./configure LDFLAGS=-L/path/to/chaplin/lib 
\end{lstlisting}
To compile with a custom user interface: 
\begin{lstlisting}
	./configure USERFILE=/path/to/custom/user_interface.f90  
\end{lstlisting}
See Section \ref{sec:newprocs} below for the implementation of custom user-specified amplitudes. \\ 
To install in a specific location: 
\begin{lstlisting}
	./configure --prefix=/path/to/installation 
\end{lstlisting}
The default installation path is the main \texttt{H1jet}-directory. \\ 
The configure script will generate the \texttt{Makefile}. \\ 
To compile H1jet with the generated \texttt{Makefile}, run: 
\begin{lstlisting}
	make [options] 
\end{lstlisting}
This command takes the following options: \texttt{make clean} will delete all module and object files; \texttt{make distclean} will delete all module and object files as well as the executable \texttt{h1jet}. \\ 

After compilation, the \texttt{bin}-directory can then be added to the user's \texttt{PATH} environment variable. Alternatively, if the user has specified an install directory with the \texttt{--prefix} option, the executable can be installed with: 
\begin{lstlisting}
	make install  
\end{lstlisting}
The executable \texttt{h1jet} can then be found in the \texttt{bin}-directory at the path specified by \texttt{--prefix}. 

\subsection{Usage} 
After compilation, H1jet can be run from the \texttt{bin}-directory with: 
\begin{lstlisting}
	./bin/h1jet [options]  
\end{lstlisting}
The following standard UNIX options are available: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{-h, --help}] Display the help message along with all possible options. 
	\item[\texttt{-v, --version}] Display the version of the installed H1jet. 
\end{description}
H1jet will display the requested information and then terminate. 

To direct the output to a file, use the option:
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{-o, --out <file>}] Direct the output to \texttt{<file>}. 
\end{description}
The physics process can be selected with: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--proc <arg>}] Specify the process. Arguments: \vspace{-2mm} 
	\begin{description}[labelwidth =\widthof{\bfseries99999}, leftmargin = !] 
		\item[\texttt{H}] $pp/p\bar{p} \rightarrow H + \text{jet}$ (default). 
		\item[\texttt{bbH}] $b\bar{b} \rightarrow H + \text{jet}$. 
		\item[\texttt{Z}] $pp/p\bar{p} \rightarrow Z + \text{jet}$. 
		\item[\texttt{user}] User specified process. See Section \ref{sec:newprocs} below for implementation. 
	\end{description}
\end{description}
Depending on the process selected, there exists different relevant options. 

\subsubsection{General Options}
The options listed here apply to all processes. 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--collider <arg>}] Specify the collider type. \\ Arguments: \texttt{pp} (default), \texttt{ppbar}. 
	\item[\texttt{--roots <value>}] Center-of-mass energy in [GeV]. \\ Default: 13000 GeV. 
	\item[\texttt{--pdf\_name <arg>}] Specify the PDF set name from LHAPDF. \\ Please make sure that the specified PDF set is available in the local installation of LHAPDF. \\ Default: \texttt{MSTW2008nlo68cl}. 
	\item[\texttt{--pdf\_mem <value>}] Integer value specifying the PDF member. \\ Default: 0. 
	\item[\texttt{--scale\_strategy <arg>}] Set the scale strategy, i.e. the dynamic $\mu = \mu_R = \mu_F$ value. Arguments: \vspace{-2mm} 
	\begin{description}[labelwidth =\widthof{\bfseries99999}, leftmargin = !] 
		\item[\texttt{M}] $\mu_R = \mu_F = M$. 
		\item[\texttt{HT}] $\mu_R = \mu_F = p_T + \sqrt{p_T^2 + M^2}$ (default). 
		\item[\texttt{MT}] $\mu_R = \mu_F = \sqrt{p_T^2 + M^2}$. 
	\end{description} \vspace{-1mm} 
	Where the mass $M$ is given by option \texttt{--mH} for processes \texttt{H} and \texttt{bbH}, option \texttt{--mZ} for process \texttt{Z}, and option \texttt{--mass} for process \texttt{user}. 
	\item[\texttt{--xmur <value>}] Additional factor $x_{\mu_R}$ for the renormalisation scale, multiplied to the choice from \texttt{--scale\_strategy}. \\ Default: 0.5. 
	\item[\texttt{--xmuf <value>}] Additional factor $x_{\mu_F}$ for the factorisation scale, multiplied to the choice from \texttt{--scale\_strategy}. \\ Default: 0.5. 
	\item[\texttt{--nbins <value>}] Number of histogram bins in the output. \\ Default: 400. 
	\item[\texttt{--log}] Enables logarithmic $x$-axis of the histogram, i.e.\ logarithmic bins and $p_{T}$. Remember to set option \texttt{--ptmin} to a non-zero value. 
	\item[\texttt{--ptmin <value>}] Minimum $p_{T}$ value [GeV]. \\ Default: 0 GeV. 
	\item[\texttt{--ptmax <value>}] Maximum $p_{T}$ value [GeV]. \\ Default: 4000 GeV. 
	\item[\texttt{--accuracy <value>}] The desired integration accuracy. \\ Default: 0.001. 
\end{description}

\subsubsection{Relevant Options for Process: \texttt{H}}
If process \texttt{H}, i.e.\ 
\begin{equation}
	pp/p\bar{p} \rightarrow H + \text{jet}
\end{equation}
has been selected, then the following options are relevant: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--mH <value>}] Higgs mass, $m_H$ [GeV]. \\ Default: 125 GeV. 
	\item[\texttt{--mW <value>}] W boson mass, $m_W$ [GeV]. \\ Default: 80.385 GeV. 
	\item[\texttt{--mZ <value>}] Z boson mass, $m_Z$ [GeV]. \\ Default: 91.1876 GeV.
	\item[\texttt{--mt <value>}] Top quark mass, $m_t$ [GeV]. \\ Default: 173.5 GeV. 
	\item[\texttt{--mb <value>}] On-shell bottom quark mass, $m_b^{\text{OS}}$ [GeV]. \\ Default: 4.65 GeV. 
	\item[\texttt{--yt <value>}] Top Yukawa factor [GeV]. \\ Default: 1. 
	\item[\texttt{--yb <value>}] Bottom Yukawa factor [GeV]. \\ Default: 1. 
	\item[\texttt{--GF <value>}] Fermi coupling constant, $G_F$ [GeV$^{-2}$]. \\ Default: $0.116638 \times 10^{-4}$ GeV$^{-2}$. 
\end{description}
Note that the Yukawa couplings are given by $y_q m_q / v$, where $y_q$ are the dimensionless factors specified by the options \texttt{--yt} and \texttt{--yb} above. \\ 

Note also that H1jet uses the $G_{\mu}$ scheme for the all electroweak parameters. Hence, the Higgs vacuum expectation value is given by $v = 1 / \sqrt{\sqrt{2} G_F}$, and the Weinberg angle is $\sin^2\left ( \theta_W \right ) = 1 - m_W^2 / m_Z^2$. \\ 

To consider a CP-odd Higgs instead, use the following option: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--cpodd}] Toggle for calculation of CP-odd Higgs instead. 
\end{description}
The coupling between the CP-odd Higgs and the SM top quark is: 
\begin{equation}
   \mathcal{L} \supset i \tilde{\kappa}_t \frac{m_t}{v} \bar{t} \gamma_5 t h
\end{equation}
where the implementation in H1jet uses $\tilde{\kappa}_t = 1$. 

\paragraph{Top-partner} 
To include a top-partner $T$ in the quark loops, it will be necessary to set the top-partner mass $m_T$ to a non-zero value by using the \texttt{--mtp} option. 

The SM top Yukawa coupling factor can be modified by the mixing angle, 
\begin{equation}
   y_t \rightarrow y_t \cos^2\theta_T \,, 
\end{equation} 
where $y_t$ is the Yukawa factor set by option \texttt{--yt}. 

The top-partner Yukawa coupling factor will likewise be modified 
\begin{equation}
   y_T \rightarrow y_T \sin^2\theta_T \,. 
\end{equation} 
with $y_T$ set by \texttt{--ytp}. 

The top-partner specific options are: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--mtp <value>}] Top-partner mass, $m_{T}$ [GeV]. \\ Default: 0 GeV. 
	\item[\texttt{--ytp <value>}] Top-partner Yukawa factor, $y_T$. \\ Default: 1. 
	\item[\texttt{--sth2 <value>}] Top-partner mixing angle, $\sin^2 \theta_T$. \\ Default: 0. 
\end{description} 
The top-partner can also be considered in the composite Higgs models as described in ref.~\cite{Banfi:2019xai}. There are four different models, $\textbf{M1}_{\textbf{5}}$, $\textbf{M1}_{\textbf{14}}$, $\textbf{M4}_{\textbf{5}}$, and $\textbf{M4}_{\textbf{14}}$, which modifies the Yukawa coupling factors in the following way: 
\begin{eqnarray}
	\textbf{M1}_{\textbf{5}}: && \hspace{5mm} \begin{array}{l} 
		y_b \rightarrow y_b c_\varepsilon \\ 
		y_t \rightarrow y_t c_\varepsilon \cos^2 \theta_T \\ 
		y_T \rightarrow y_T c_\varepsilon \sin^2 \theta_T \\ 
		\tilde{y}_b = \tilde{y}_t = \tilde{y}_T = 0 
	\end{array} \\ \nonumber \\ 
	\textbf{M1}_{\textbf{14}}: && \hspace{5mm} \begin{array}{l} 
		y_b \rightarrow y_b \frac{2 c_\varepsilon^2 - 1}{c_\varepsilon} \\ 
		y_t \rightarrow y_t \frac{2 c_\varepsilon^2 - 1}{c_\varepsilon} \cos^2\theta_T  \\ 
		y_T \rightarrow y_T \frac{2 c_\varepsilon^2 - 1}{c_\varepsilon} \sin^2\theta_T  \\ 
		\tilde{y}_b = \tilde{y}_t = \tilde{y}_T = 0 
	\end{array} \\ \nonumber \\ 
	\textbf{M4}_{\textbf{5}}: && \hspace{5mm} \begin{array}{l} 
		y_b \rightarrow y_b c_\varepsilon \\ 
		y_t \rightarrow y_t c_\varepsilon \left ( \cos^2\theta_R - \frac{s_\varepsilon^2}{1 + c_\varepsilon^2} \left ( \cos^2\theta_L - \cos^2\theta_R \right ) \right ) \\ 
		y_T \rightarrow y_T c_\varepsilon \left ( \sin^2\theta_R - \frac{s_\varepsilon^2}{1 + c_\varepsilon^2} \left ( \sin^2\theta_L - \sin^2\theta_R \right ) \right ) \\ 
		\tilde{y}_b = 0 \\
		\tilde{y}_t = \frac{4 c_\varepsilon s_\varepsilon}{\sqrt{2(1 + c_\varepsilon^2)}} \text{Im}(c_1) \sin\theta_R \cos\theta_R \\ 
		\tilde{y}_T = -\tilde{y}_t 
	\end{array} \\ \nonumber \\ 
	\textbf{M4}_{\textbf{14}}: && \hspace{5mm} \begin{array}{l} 
		y_b \rightarrow y_b \frac{2 c_\varepsilon^2 - 1}{c_\varepsilon} \\ 
		y_t \rightarrow y_t \left ( \frac{(2 c_\varepsilon^2 - 1)}{c_\varepsilon} \cos^2\theta_R - \frac{s_\varepsilon^2 c_\varepsilon (8 c_\varepsilon^2 - 3)}{1 - 3 c_\varepsilon^2 + 4 c_\varepsilon^4} \left ( \cos^2\theta_L - \cos^2\theta_R \right ) \right ) \\ 
		y_T \rightarrow y_T \left ( \frac{(2 c_\varepsilon^2 - 1)}{c_\varepsilon} \sin^2\theta_R - \frac{s_\varepsilon^2 c_\varepsilon (8 c_\varepsilon^2 - 3)}{1 - 3 c_\varepsilon^2 + 4 c_\varepsilon^4} \left ( \sin^2\theta_L - \sin^2\theta_R \right ) \right )) \\ 
		\tilde{y}_b = 0 \\
		\tilde{y}_t = \frac{4 s_\varepsilon (1 - 2 s_\varepsilon^2)}{\sqrt{2(1 - 3 c_\varepsilon^2 + 4 c_\varepsilon^4)}} \text{Im}(c_1) \sin\theta_R \cos\theta_R \\ 
		\tilde{y}_T = -\tilde{y}_t 
	\end{array}
\end{eqnarray}
where the $\tilde{y}$'s are the CP-odd couplings, and, 
\begin{equation}
	s_\varepsilon = \frac{v}{f} \,, \hspace{7 mm} \text{ and } \hspace{7 mm} c_\varepsilon = \sqrt{1 - s_\varepsilon^2} \,,
\end{equation}
and where the $\theta_R$ and $\theta_L$ mixing angles are related to $\theta_T$, 
\begin{eqnarray}
	& \theta_R = \theta_T \,, \nonumber \\ 
	& \tan^2\theta_L = \frac{m_T^2}{m_t^2} \tan^2\theta_T \,, \\ 
	& \sin^2\theta_L = \frac{1}{1 + \tan^2\theta_L}, \hspace{7 mm} \cos^2\theta_L = 1 - \sin^2\theta_L \,. \nonumber  
\end{eqnarray}
The composite Higgs top-partner model specific options are: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--model <arg>}] Specify the top-partner model. Arguments: \vspace{-2mm} 
	\begin{description}[labelwidth =\widthof{\bfseries999999}, leftmargin = !] 
		\item[\texttt{M1\_5}] $\textbf{M1}_{\textbf{5}}$, with a light top-partner transforming as a $\textbf{1}_{\textbf{2/3}}$ of $\text{SO}(4)$, and the SM top-bottom doublet embedded in a $\textbf{5}$ of $\text{SO}(5)$ (default). 
		\item[\texttt{M1\_14}] $\textbf{M1}_{\textbf{14}}$, with a light top-partner transforming as a $\textbf{1}_{\textbf{2/3}}$ of $\text{SO}(4)$, and the SM top-bottom doublet embedded in a $\textbf{14}$ of $\text{SO}(5)$. 
		\item[\texttt{M4\_5}] $\textbf{M4}_{\textbf{5}}$, with a light top-partner transforming as a $\textbf{4}_{\textbf{2/3}}$ of $\text{SO}(4)$, and the SM top-bottom doublet embedded in a $\textbf{5}$ of $\text{SO}(5)$. 
		\item[\texttt{M4\_14}] $\textbf{M4}_{\textbf{5}}$, with a light top-partner transforming as a $\textbf{4}_{\textbf{2/3}}$ of $\text{SO}(4)$, and the SM top-bottom doublet embedded in a $\textbf{14}$ of $\text{SO}(5)$. 
	\end{description} \vspace{-1mm} 
	\item[\texttt{--imc1 <value>}] Imaginary part of the $c_1$ coefficient, $\text{Im}(c_1)$. \\ Default: 0.  
	\item[\texttt{--fscale <value>}] Top-partner confinement scale, $f$ [GeV]. \\ Default: 0 GeV. 
\end{description} 

\paragraph{Multiple top-partners models}
To include multiple top-partners in the quark loops, it will be necessary to specify an input file with the masses and Yukawa coupling factors for each top-partner. This can be done with the following option: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{-i, --in <file>}] Include input file with top-partner masses and Yukawas. See the file \texttt{SM.dat} for an example. 
\end{description} 
The first line of the input file should specify the number of top-partners, e.g.: 
\begin{lstlisting}
	nqmax: 2 
\end{lstlisting}
This should be followed by \texttt{nqmax} number of lines -- one for each top-partner -- in the format of four numbers specifying the mass, $\kappa$, $\tilde{\kappa}$, and loop approximation, in that order. For example, for a SM top quark: 
\begin{lstlisting}
	173.5 1.0 0.0 1 
\end{lstlisting}
with mass $173.5$ GeV, $\kappa = 1$, $\tilde{\kappa} = 0$, and the loop approximation set to $1$. \\ 

The dimensionless Yukawa coupling factors $\kappa$ and $\tilde{\kappa}$ are the CP-even and CP-odd couplings respectively, with the following Lagrangian: 
\begin{equation}
	\mathcal{L} \supset -m_T \bar{T}T + \kappa \frac{m_T}{v} \bar{T}T h + i \tilde{\kappa} \frac{m_T}{v} \bar{T} \gamma_5 T h 
\end{equation}
for a top-partner $T$. \\ 

The integer value specifying the loop approximations can take the following values: 
\begin{description}[labelindent=3\parindent, labelwidth =\widthof{\bfseries9999}, leftmargin = !] 
	\item[$0$] Small mass limit for fermions. 
	\item[$1$] Full mass limit for fermions. 
	\item[$2$] Large mass limit for fermions. 
	\item[$3$] Full mass limit for scalars. 
	\item[$4$] Large mass limit for scalars. 
\end{description}
See Section \ref{sec:loopapprox} for more information on the loop approximations. 

\paragraph{MSSM}
To include the MSSM stops $\tilde{t}_1$ and $\tilde{t}_2$ in the quark loops, it will be necessary to set the first stop mass $m_{\tilde{t}_1}$ to a non-zero value by using the \texttt{--mst} option. The second stop mass is then given by 
\begin{equation}
	m_{\tilde{t}_2} = \sqrt{m_{\tilde{t}_1}^2 + \Delta m^2} 
\end{equation}
where $\Delta m$ is set with the \texttt{--delta} option. 

The stop Yukawa coupling factors will be given by: 
\begin{equation}
   y_{\tilde{t}_1} = \frac{m_t^2}{m_{\tilde{t}_1}^2} \left [ \alpha_1 \cos^2 \theta_{\tilde{t}} + \alpha_2 \sin^2 \theta_{\tilde{t}} + 2 - \frac{\Delta m^2}{2 m_t^2} \sin^2\left ( 2 \theta_{\tilde{t}} \right ) \right ] \,,
\end{equation} 
\begin{equation}
   y_{\tilde{t}_2} = \frac{m_t^2}{m_{\tilde{t}_2}^2} \left [ \alpha_1 \sin^2 \theta_{\tilde{t}} + \alpha_2 \cos^2 \theta_{\tilde{t}} + 2 + \frac{\Delta m^2}{2 m_t^2} \sin^2\left ( 2 \theta_{\tilde{t}} \right ) \right ] \,, 
\end{equation} 
where 
\begin{equation}
   \alpha_1 = \frac{m_Z^2}{m_t^2} \cos \left ( 2 \beta \right ) \left [ 1 - \frac{4}{3} \sin^2\theta_W \right ] \,, 
\end{equation} 
\begin{equation}
   \alpha_2 = \frac{4}{3} \frac{m_Z^2}{m_t^2} \cos \left ( 2 \beta \right ) \sin^2\theta_W \,. 
\end{equation} 
Note that $m_t$, $m_Z$, and $\sin^2\theta_W$ can be set with the \texttt{--mt}, \texttt{--mZ}, and \texttt{--sinwsq} options respectively, while $\sin^2 \theta_{\tilde{t}}$ and $\tan\beta$ are MSSM specific options and can be set with the \texttt{--sth2} and \texttt{--tbeta} options. 

All of the MSSM specific options are: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--mst <value>}] MSSM stop mass, $m_{\tilde{t}}$ [GeV]. \\ Default: 0 GeV. 
	\item[\texttt{--delta <value>}] MSSM stop mass separation $\Delta m$ [GeV]. \\ Default: 0 GeV. 
	\item[\texttt{--sth2 <value>}] Stop mixing angle, $\sin^2 \theta_{\tilde{t}}$. \\ Default: 0. 
	\item[\texttt{--tbeta <value>}] Ratio of VEVs in MHDMs, $\tan\beta$. \\ Default: 0. 
\end{description}
Note that the top partner mass $m_{T}$ and MSSM stop mass $m_{\tilde{t}_1}$ can not both be set non-zero at the same time. 

The MSSM implementation described here is in the decoupling limit, $m_A \gg m_Z$, of ref.~\cite{Gunion:2002zf} and~\cite{Banfi:2018pki}. 

\subsubsection{Relevant Options for Process: \texttt{bbH}}
If process \texttt{bbH}, i.e.\ 
\begin{equation}
	b\bar{b} \rightarrow H + \text{jet}
\end{equation}
has been selected, then the following options are relevant: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--mH <value>}] Higgs mass, $m_H$ [GeV]. \\ Default: 125 GeV. 
	\item[\texttt{--GF <value>}] Fermi coupling constant, $G_F$ [GeV$^{-2}$]. \\ Default: $0.116638 \times 10^{-4}$ GeV$^{-2}$. 
	\item[\texttt{--mbmb <value>}] $\overline{\text{MS}}$ bottom quark mass, $m_b^{\overline{\text{MS}}}$ [GeV]. \\ Default: 4.18 GeV. 
\end{description}

\subsubsection{Relevant Options for Process: \texttt{Z}}
If process \texttt{Z}, i.e.\ 
\begin{equation}
	pp/p\bar{p} \rightarrow Z + \text{jet}
\end{equation}
has been selected, then the following options are relevant: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--mZ <value>}] Z boson mass, $m_Z$ [GeV]. \\ Default: 91.1876 GeV.
	\item[\texttt{--mW <value>}] W boson mass, $m_W$ [GeV]. \\ Default: 80.385 GeV. 
	\item[\texttt{--GF <value>}] Fermi coupling constant, $G_F$ [GeV$^{-2}$]. \\ Default: $0.116638 \times 10^{-4}$ GeV$^{-2}$. 
\end{description}

\subsubsection{Relevant Options for Process: \texttt{user}}
In the case of process \texttt{user}, i.e.\ a custom user-specified process, any of the above physics options may be relevant if they are used in the custom amplitude code. The code will have to be inspected to determine this. The only built-in process-relevant option is: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--mass <value>}] Relevant mass in the user specified process, $M$ [GeV]. Used in the scale choice and in the setup of kinematics. \\ Default: 0 GeV. 
\end{description}
Additional options may be added depending on the custom process/amplitude. See Section \ref{sec:newprocs} below for more details on the implementation of a custom process. 

\subsubsection{Loop Approximations} \label{sec:loopapprox} 
Small and large mass limits can be used as approximations for the quarks in the loop calculations. This requires some knowledge of the meaning of the approximations, hence this needs to be set by the user at compile time. 

In the file \texttt{input.f90} located in the \texttt{src}-directory, the subroutine \texttt{reset\_iloop\_array} can be found. This subroutine can be used by the user to set the \texttt{iloop\_array}, which is an array specifying the approximation used for each loop particle. The approximations that can be used are: 
\begin{description}[labelindent=3\parindent, labelwidth =\widthof{\bfseries9999999999999999999}, leftmargin = !] 
	\item[\texttt{iloop\_sm\_fermion}] Small mass limit for fermions. 
	\item[\texttt{iloop\_fm\_fermion}] Full mass limit for fermions. 
	\item[\texttt{iloop\_lm\_fermion}] Large mass limit for fermions. 
	\item[\texttt{iloop\_fm\_scalar}] Full mass limit for scalars. 
	\item[\texttt{iloop\_lm\_scalar}] Large mass limit for scalars. 
\end{description}
The size of the array must match the number of particles appearing in the loops. This should be checked by the user.  

Here is an example snippet of Fortran code which could appear in the \texttt{reset\_iloop\_array} subroutine, which sets the approximations for an effective theory with SM top and bottom quarks, and one infinitely heavy top-partner: 
\begin{lstlisting}[language=Fortran, 
                   keywordstyle=\color{Red},
                   stringstyle=\color{Green},
                   identifierstyle=\color{Blue},
                   showstringspaces=false]
    if (size(iloop_array) == 3) then
      iloop_array = (/ iloop_fm_fermion, iloop_fm_fermion, &
                     & iloop_lm_fermion /)
    else
      call wae_error('reset_iloop_array', 'Expected size of &
           & iloop_array is 3, whereas actual one is', &
           & intval = size(iloop_array))
    end if
\end{lstlisting}

\subsubsection{Output}
H1jet will print out a brief summary of the settings and parameters used, as well as the born-level cross-section $\sigma_0$, followed by the $\mathrm{d}\sigma/\mathrm{d}p_{T}$ and $\sigma(p_{T})$ for each $p_T$ bin. \\ 

The helper script \texttt{PlotH1jet.py} facilitates easy and quick plotting of the output from H1jet. The script requires Python 3 installed in order to run. Simply pipe the output from H1jet to the script: 
\begin{lstlisting}
	./h1jet [options] | python PlotH1jet.py 
\end{lstlisting}
A resulting example plot with default settings in H1jet is shown in \autoref{fig:h1jetresult}. 

\begin{figure}[tbh] 
  \centering
  \includegraphics[width=0.6\linewidth]{figures/h1jetresult}
  \captionof{figure}{The $p_{T}$ distribution for the SM process $pp \rightarrow H + \text{jet}$ from H1jet with default settings.}
  \label{fig:h1jetresult}
\end{figure}

\newpage 

\section{Benchmarking} \label{sec:benchmarking}
The various process implementations in H1jet have been compared to those of \textsc{SusHi}~\cite{Harlander:2012pb,Harlander:2016hcx}, and have all been found to be in agreement. 

The relative ratio between the H1jet result and the \textsc{SusHi} result for the $p_T$ distribution for the CP-odd Higgs are shown in \autoref{fig:cpoddratio}, and is found to be in agreement within the Monte Carlo error of \textsc{SusHi} for a large range of $p_T$ values. Smaller deviations may be due to the different handling of PDF evolution between the two programs. For low $p_T$ values, the larger deviation may be due to numerical issues in the calculation of the harmonic polylogarithms. Overall the agreement with \textsc{SusHi} is within $3 \times 10^{-4}$. 

The low $p_T$ behaviour in \autoref{fig:cpoddratio} is due to possible numerical instability. The H1jet result can be further checked in the $p_{T} \rightarrow 0$ limit, by comparing it to the resummation expression, 
\begin{equation}
	\frac{\mathrm{d} \sigma}{\mathrm{d} p_T} \xrightarrow{p_T \rightarrow 0} \sigma_0 \left [ 4 C_A \frac{\alpha_s}{\pi} \frac{1}{p_T} \left(\ln\left ( \frac{m_a}{p_T} \right ) + \mathcal{O} (1)\right) \right ] \,, \label{eq:resum}
\end{equation}
where $\sigma_0$ is the total born-level cross-section for $gg \rightarrow h$. In \autoref{fig:cpoddresum}, we show $\frac{p_T}{\sigma_0} \left ( \frac{\mathrm{d} \sigma}{\mathrm{d} p_T} \right )$ with the first term of \autoref{eq:resum} subtracted, as a function of $\ln \frac{p_T}{m_h}$. For $p_T \rightarrow 0$ this goes nicely towards a constant as expected. 

\newpage 

\begin{figure}[h!] 
\centering
\begin{minipage}{.485\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/CPoddratio}
  \captionof{figure}{The relative difference between the H1jet result and that of \textsc{SusHi} for the $p_T$ distribution for a CP-odd Higgs. The grey band indicates the Monte Carlo error of \textsc{SusHi}.}
  \label{fig:cpoddratio}
\end{minipage}%
\hfill% 
\begin{minipage}{.485\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/CPoddresum}
  \captionof{figure}{The distribution $\frac{p_T}{\sigma_0} \left ( \frac{\mathrm{d} \sigma}{\mathrm{d} p_T} \right )$ with the first term of the $p_T$ resummation subtracted, as a function of $\ln \frac{p_T}{m_a}$. For low $p_T$ values it convergences to a constant value.}
  \label{fig:cpoddresum}
\end{minipage}
\end{figure}

The relative ratio between the H1jet and \textsc{SusHi} results for the MSSM are shown in \autoref{fig:mssmratio} and is within $2 \times 10^{-4}$. Again the low $p_T$ behaviour can be checked by comparing to the resummed expression in \autoref{fig:mssmresum}. 

\begin{figure}[h!] 
\centering
\begin{minipage}{.485\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/MSSMratio}
  \captionof{figure}{The relative difference between the H1jet result and that of \textsc{SusHi} for the $p_T$ distribution in the MSSM. The grey band indicates the Monte Carlo error of \textsc{SusHi}.}
  \label{fig:mssmratio}
\end{minipage}%
\hfill% 
\begin{minipage}{.485\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/MSSMresum}
  \captionof{figure}{The distribution $\frac{p_T}{\sigma_0} \left ( \frac{\mathrm{d} \sigma}{\mathrm{d} p_T} \right )$ with the first term of the $p_T$ resummation subtracted, as a function of $\ln \frac{p_T}{m_a}$. For low $p_T$ values it convergences to a constant value.}
  \label{fig:mssmresum}
\end{minipage}
\end{figure}

\newpage 

\section{Adding new processes to H1jet} \label{sec:newprocs} 
H1jet can be interfaced to use the squared matrix element evaluated from a custom Fortran code. The implementation may be most easily explained with a specific example. Please read this section carefully before attempting to use the interface. 

\subsection{Example: Axion-Like-Particle (ALP)}
We will present here a specific example of adding to H1jet the production of a light axion-like-particle (ALP) $a$ along with a jet. We will, for simplicity, only consider the gluon-fusion channel, 
\begin{equation}
    g g \rightarrow g a \,. 
\end{equation}
This is a tree-level process due to an effective ALP-gluon coupling, 
\begin{equation}
   \delta \mathcal{L}_a \supset -c_{\tilde{G}}\frac{a}{f_a} G_{\mu\nu}^{a} \tilde{G}^{a \mu\nu} \,. \label{eq:ggacoupling}
\end{equation}
The model and the \textsc{FeynRules}~\cite{Alloul:2013bka} model files
are described and provided in ref.~\cite{Brivio:2017ije}. We will be
using \textsc{FeynCalc}~\cite{Mertig:1990an,Shtabovenko:2016sxi,Shtabovenko:2020gxv} to evaluate the amplitude from
the model, so we will have to convert the \textsc{FeynRules} model to
a \textsc{FeynArts}~\cite{Hahn:2000kx} model in Mathematica:
\begin{mmaCell}{Code}
<< FeynRules` 
\end{mmaCell}
\begin{mmaCell}{Code}
LoadModel["SM.fr", "alp_linear.fr", "alp_linear_operators.fr"];  
\end{mmaCell}
\begin{mmaCell}{Code}
WriteFeynArtsOutput[LSM + LALP, CouplingRename -> False]; 
\end{mmaCell}
The resulting \textsc{FeynArts} model files are written to a new directory \texttt{ALP\_linear\_FA}, which needs to be moved to the \textsc{FeynArts/Models} directory. Note that in the \textsc{FeynArts} model, the ALP field is called \texttt{S[4]} and the gluon fields are called \texttt{V[4]}. 

In a new Mathematica session, load \textsc{FeynCalc} with \textsc{FeynArts}: 
\begin{mmaCell}{Code}
$LoadAddOns = {"FeynArts"}; 
\end{mmaCell}
\begin{mmaCell}{Code}
<< FeynCalc` 
\end{mmaCell}
The \textsc{FeynArts/Models} directory can be located with: 
\begin{mmaCell}{Code}
$FeynArtsDir
\end{mmaCell}
First patch the \texttt{ALP\_linear\_FA} model with: 
\begin{mmaCell}{Code}
FAPatch[PatchModelsOnly -> True] 
\end{mmaCell}
This ensures that the model files works with \textsc{FeynCalc}. 

Then create the tree-level $2 \rightarrow 2$ topologies and insert the fields for our process: 
\begin{mmaCell}{Code}
tops = CreateTopologies[0, 2 -> 2];
\end{mmaCell}
\begin{mmaCell}{Code}
ins = InsertFields[tops, {V[4], V[4]} -> {V[4], S[4]}, InsertionLevel -> {Classes}, Model -> "ALP_linear_FA", GenericModel -> "ALP_linear_FA"];
\end{mmaCell}
It is possible to draw the Feynman diagrams for the process as a check: 
\begin{mmaCell}{Code}
Paint[ins, ColumnsXRows -> {2, 1}, Numbering -> Simple, SheetHeader -> None, ImageSize -> {512, 256}]; 
\end{mmaCell}
We will then set up the amplitude: 
\begin{mmaCell}{Code}
feynamp = CreateFeynAmp[ins];  
\end{mmaCell}
\begin{mmaCell}{Code}
amp = FCFAConvert[feynamp, IncomingMomenta -> {k1, k2}, OutgoingMomenta -> {k3, k4}, UndoChiralSplittings -> True, ChangeDimension -> 4, TransversePolarizationVectors -> {k1, k2, k3}, List -> False, SMP -> True, Contract -> True, DropSumOver -> True] 
\end{mmaCell}
While not strictly necessary, it is recommended to enable the \texttt{SMP} option. Any additional substitutions in the amplitude can be specified with the \texttt{FinalSubstitutions} option. 

We will then set up the kinematics: 
\begin{mmaCell}{Code}
FCClearScalarProducts[]; 
\end{mmaCell}
\begin{mmaCell}{Code}
SetMandelstam[s, t, u, k1, k2, -k3, -k4, 0, 0, 0, mA]; 
\end{mmaCell}
We introduce here a parameter \texttt{mA} for the ALP mass $m_a$. 

We can then square the amplitude: 
\begin{mmaCell}{Code}
ampsquared = Simplify[
  (TrickMandelstam[#1, {s, t, u, mA^2}] & )[
    (DoPolarizationSums[#1, k2, k1, ExtraFactor -> 1/2] & )[
      (DoPolarizationSums[#1, k1, k2, ExtraFactor -> 1/2] & )[ 
        (DoPolarizationSums[#1, k3, 0] & )[ 
          (SUNSimplify[#1, Explicit -> True, SUNNToCACF -> False] & )[
            FeynAmpDenominatorExplicit[(1 / (SUNN^2 - 1)^2) * (amp * ComplexConjugate[amp])]]]]]]] /. SUNN -> 3 
\end{mmaCell}
Setting the \texttt{SUNNToCACF} option in \texttt{SUNSimplify[]} to \texttt{False} is not necessary, nor is it necessary to fix \texttt{SUNN} to $3$. This can be handled by the dressing script and H1jet. 

Finally, we will write the amplitude as Fortran code to a file: 
\begin{mmaCell}{Code}
Write2["ALP_amp.f90", gg = ampsquared, FormatType -> FortranForm, FortranFormatDoublePrecision -> False] 
\end{mmaCell}
Note here that we specify the gluon-gluon channel with the \texttt{gg = ampsquared} input to the function. This is required for the subsequent dressing script to work properly. It is important to specify the $2$-particle initial state by using combinations of \texttt{g}, \texttt{u}, \texttt{d}, \texttt{c}, \texttt{s}, \texttt{b}, \texttt{ubar}, \texttt{dbar}, \texttt{cbar}, \texttt{sbar}, and \texttt{bbar}. One can also use \texttt{q} and \texttt{qbar} for all the light quarks and antiquarks respectively, i.e.\ $u$, $d$, $c$, and $s$. For example, \texttt{bbbar} will be the $b\bar{b}$ channel. \\ 

The generated Fortran code \texttt{ALP\_amp.f90} will have to be dressed by the Python helper script \texttt{DressUserAmpCode.py}: 
\begin{lstlisting}
	python DressUserAmpCode.py ALP_amp.f90 
\end{lstlisting}
This will produce a dressed Fortran code file by default called \texttt{user\_interface.f90}. 

The helper script has a help message which can be called with \texttt{-h} or \texttt{--help}. The name of the output file can be specified with the \texttt{-o} option. Multiple input Fortran files can be provided to the helper script. The full usage is: 
\begin{lstlisting}
	python DressFeynCalcCode.py [-h] [-o [OUTFILE]] inputfile [inputfile ...] 
\end{lstlisting}
The provided input Fortran code files does not necessarily have to be generated with \textsc{FeynCalc}. They can be generated by any other program or even be written by hand. \\ 

To use the new dressed custom Fortran code with H1jet, it is necessary to recompile H1jet with the custom Fortran code: 
\begin{lstlisting}
	./configure USERFILE=/path/to/custom/user_interface.f90 
	make clean
	make 
\end{lstlisting}
Running \texttt{./h1jet --help} we see that three new additional options have been added: 
\begin{description}[labelindent=\parindent, labelwidth =\widthof{\bfseries9999999999999999999999}, leftmargin = !] 
	\item[\texttt{--c\_CGtil <value>}] The Wilson coefficient $c_{\tilde{G}}$ in \autoref{eq:ggacoupling}. 
	\item[\texttt{--c\_mA <value>}] The ALP mass, $m_a$. 
	\item[\texttt{--c\_fa <value>}] The ALP suppression scale $f_a$ in \autoref{eq:ggacoupling}. 
\end{description}
The leading \texttt{c\_} in the name stands for ``custom'' and is automatically added in order to avoid naming issues in the code. \\ 

The result from the ALP implementation in H1jet is shown in \autoref{fig:alpresult} and can be compared to the H1jet result for the CP-odd Higgs by using a single top quark in the loop with an infinite mass limit, resulting in an effective coupling between the CP-odd Higgs and the gluons. The respective ALP and CP-odd couplings are then related as such, 
\begin{equation}
	\frac{c_{\tilde{G}}^2}{f_a^2} = \frac{\alpha_s^2}{64 \pi^2 v^2} \,. 
\end{equation}
The comparison is shown in \ref{fig:alpratio} where we see agreement within $4\times 10^{-6}$. 

The result can also be compared to the same \textsc{FeynRules} model
used with \textsc{MadGraph5\_aMC@NLO}~\cite{Alwall:2014hca}, where our
code takes one second to run, while \textsc{MadGraph} can take up to
several hours depending on the number of events, due to
\textsc{MadGraph} running a full Monte Carlo integration.
\begin{figure}[tbh] 
\centering
\begin{minipage}{.485\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/ALPresult}
  \captionof{figure}{The $p_{T}$ distribution for the process $gg \rightarrow ga$ from H1jet with the amplitude from the user interface.}
  \label{fig:alpresult}
\end{minipage}%
\hfill% 
\begin{minipage}{.485\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/ALPratio}
  \captionof{figure}{The ratio between the result from H1jet with the amplitude from \textsc{FeynCalc} and the CP-odd result.}
  \label{fig:alpratio}
\end{minipage}
\end{figure}

\subsubsection{The Total Cross-Section} \label{sec:alptotxsec} 
While not strictly necessary for the user interface to run, it is still recommended to add the code for the evaluation of the total cross-section to the custom user interface. This is easy to do as well. We will here show it for the ALP model. 

We start with considering the gluon-fusion ALP production, $gg \rightarrow a$. In Mathematica, create a tree-level $2 \rightarrow 1$ topology, and insert the fields: 
\begin{mmaCell}{Code}
tops = CreateTopologies[0, 2 -> 1];
\end{mmaCell}
\begin{mmaCell}{Code}
ins = InsertFields[tops, {V[4], V[4]} -> {S[4]}, InsertionLevel -> {Classes}, Model -> "ALP_linear_FA", GenericModel -> "ALP_linear_FA"];
\end{mmaCell}
Then set up the amplitude: 
\begin{mmaCell}{Code}
feynamp = CreateFeynAmp[ins]; 
\end{mmaCell}
\begin{mmaCell}{Code}
amp = FCFAConvert[feynamp, IncomingMomenta -> {k1, k2}, OutgoingMomenta -> {k3}, UndoChiralSplittings -> True, ChangeDimension -> 4, TransversePolarizationVectors -> {k1, k2}, List -> False, SMP -> True, Contract -> True, DropSumOver -> True] 
\end{mmaCell}
Set up the kinematics: 
\begin{mmaCell}{Code}
FCClearScalarProducts[]; 
\end{mmaCell}
\begin{mmaCell}{Code}
SP[k1, k1] = 0; 
\end{mmaCell}
\begin{mmaCell}{Code}
SP[k2, k2] = 0; 
\end{mmaCell}
\begin{mmaCell}{Code}
SP[k3, k3] = mA^2; 
\end{mmaCell}
\begin{mmaCell}{Code}
SP[k1, k2] = mA^2 / 2; 
\end{mmaCell}
Square the amplitude: 
\begin{mmaCell}{Code}
ampsquared = Simplify[
  (DoPolarizationSums[#1, k2, k1, ExtraFactor -> 1/2] & )[
    (DoPolarizationSums[#1, k1, k2, ExtraFactor -> 1/2] & )[ 
      (SUNSimplify[#1, Explicit -> True, SUNNToCACF -> False] & )[
        FeynAmpDenominatorExplicit[(1 / (SUNN^2 - 1)^2) * (amp * ComplexConjugate[amp])]]]]]
\end{mmaCell}
For a $2 \rightarrow 1$ process the parton-level cross-section is: 
\begin{equation}
	\hat{\sigma} = \frac{\pi}{s} \left \vert \mathcal{M} \right \vert^2 \delta \left ( s - m_a^2 \right ) 
\end{equation}
\begin{mmaCell}{Code}
xsec = Pi * ampsquared / mA^2 
\end{mmaCell}
Finally, write the cross-section as a Fortran code file: 
\begin{mmaCell}{Code}
Write2["ALP_xsec.f90", xsecgg = xsec, FormatType -> FortranForm, FortranFormatDoublePrecision -> False] 
\end{mmaCell}
Note here that 


\section{Conclusions}
\label{sec:the-end}


\paragraph{Acknowledgements.} The idea of having a fast program to
compute transverse momentum spectra started from the collaboration of
AB on related topics with G.~Zanderighi, P.~F.~Monni and F.~Caola. AB
acknowledges many useful discussions with them on the topic. AB also
wishes to thank B.~Dillon and S.~Kvedarait\.e for contributions to a
private preliminary version of H1jet. The studentship of AL is
supported by the Science Technology and Facilities Council (STFC)
under grant number ST/P000819/1. The work of AB is supported by the
Science Technology and Facilities Council (STFC) under grants number
ST/P000819/1 and ??????.

\appendix

\section{Implementation of scalar integrals}
\label{sec:scalar-integrals}

This appendix contains the details of how H1jet computes one-loop
scalar integrals that are relevant for Higgs production. These
integrals depend on one internal mass, which we denot by $m$, and are
functions of Mandelstam
invariants.

Scalar integrals can be written in terms of logarithms and dilogarithms of complex
arguments, which require appropriate analytic continuations. Instead of performing such manipulations ourselves, we have
decided to use the implementation of the library CHAPLIN, and recast all relevant trascendental
functions into harmonic polylogarithms $H(\vec a;z)$, with
$\vec a=(a_1,\dots,a_n)$. For real values of the argument of a polylogarithm, CHAPLIN
uses the $+i\varepsilon$ prescription, i.e.\ $H(\vec a;z)$ with $z$
real is interpreted as $H(\vec a;z+i\varepsilon)$. Therefore, we need
to make sure that the imaginary part of the argument of scalar
integrals is consistent with the convention of CHAPLIN.

The relevant one-loop integrals we need to deal with are  
bubbles, triangles and boxes.

\paragraph{Bubbles.} The bubble integral is defined as
\begin{equation}
  \label{eq:bubble}
  B_0(s)=2 -\sqrt{1-\frac{4(m^2-i\varepsilon)}{s}}\ln\left[-\frac{z}{1-z}\right]\,,
\end{equation}
where 
\begin{equation}
  \label{eq:z}
  z=\frac{1}{2}\left(1+\sqrt{1-\frac{4(m^2-i\varepsilon)}{s}}\right)\,.
\end{equation}
The argument of the logarithm in eq.~\eqref{eq:bubble} has a different
from according to the value of $s$:
\begin{equation}
  \label{eq:z-omz}
  -\frac{z}{1-z} = \left\{
    \begin{split}
      &-\frac{1+\sqrt{1+\frac{4m^2}{|s|}}}{1-\sqrt{1+\frac{4m^2}{|s|}}}\,,\qquad \qquad s<0\,,\\
        & -\frac{1+i\sqrt{\frac{4m^2}{s}-1}}{1-i\sqrt{\frac{4m^2}{s}-1}}\,,\qquad \quad\>\> 0<s<4m^2\,,\\
        &
        -\frac{1-\sqrt{1-\frac{4m^2}{s}}}{1-\sqrt{1-\frac{4m^2}{s}}}-i\varepsilon\,,\qquad
        s>4m^2
    \end{split}
\right.
\end{equation}
Note that the only case in which one needs a small imaginary part is
the case $s>4m^2$. This imaginary part has the opposite convention as
in CHAPLIN. As a solution, we invert the argument of the logarithm and
use the identity $\ln z = -\ln(1/z)$. In practice, after an appropriate analytic
continuation of the square root, we define
\begin{equation}
  \label{eq:z-implemented}
  z \equiv \left\{\begin{split}
      \frac{1}{2}\left(1+\sqrt{1-\frac{4m^2}{s}}\right)\,,& \qquad \frac{4m^2}{s}<1\\
      \frac{1}{2}\left(1+i\sqrt{\frac{4m^2}{s}-1}\right)\,,& \qquad \frac{4m^2}{s}>1
    \end{split}
    \right.
  \end{equation}
and implement the bubble as follows:
\begin{equation}
  \label{eq:bubble-implemented}
  B_0(s)=
%    2 +(2 z-1) \,H\left(0;\frac{z-1}{z}\right) \,.
      2 -(2 z-1) \,H\left(1;\frac{1}{z}\right) \,.
\end{equation}
Note that a logarithm of a negative number can be also correctly
analytically continued by using the default FORTRAN implemementation
of the complex logarithm. As for CHAPLIN, FORTRAN assumes that a
negative number has a small positive imaginary part. Therefore, in
case we have a small negative imaginary part, we can still use the
relation $\ln z = -\ln(1/z)$, which gives the correct analytic continuation.

 
\paragraph{Triangles.} The triangle integral $C_0(s)$ is defined as
\begin{equation}
  \label{eq:triangle}
  C_0(s) = \frac{1}{2s}\ln^2\left[-\frac{z}{1-z}\right]\,,
\end{equation}
where $z$ is given in eq.~\eqref{eq:z}. Again, for $s>4m^2$, the argument of the logarithm has the opposite sign with respect to what is implicitly assumed by CHAPLIN. Therefore, we invert again the argument of the logarithm, and using the definition of $z$ in eq.~\eqref{eq:z-implemented}, we implement the triangle as follows:
\begin{equation}
  \label{eq:triangle-HPL}
%  s\,C_0(s) = H\left(0,0;\frac{z-1}{z}\right)\,.
  s\,C_0(s) = H\left(1,1;\frac{1}{z}\right)\,.
\end{equation}

\paragraph{Boxes.} The scalar four-point function with three massless
(the gluons) and one massive (the Higgs boson) external lines is given
by~\cite{Baur:1989cm},
\begin{multline}
  \label{eq:box}
	D(s, t) = \frac{1}{st} \int_{0}^{1} \frac{\mathrm{d}x}{x(1-x)+m^2u/(ts)} \left [- \ln\left ( 1 - i \varepsilon - \frac{m_H^2}{m^2} x (1-x) \right )\right. \\ \left.
	+ \ln\left ( 1 - i \varepsilon - \frac{s}{m^2} x (1-x) \right ) + \ln\left ( 1 - i \varepsilon - \frac{t}{m^2} x (1-x) \right ) \right ] \,, 
\end{multline}
which can be expressed in terms of complex dilogarithms by using the exact result
\begin{multline}
  \label{eq:ci-dilogs}
  \frac{1}{st} \int_{0}^{1} \frac{dx}{x(1-x)+m^2u/(ts)} \ln\left ( 1 - i \varepsilon - \frac{v}{m^2} x (1-x) \right )= \frac{2}{\sqrt{1+4m^2u/(ts)}} \times  \\ \times
  \left[
    \mathrm{Li}_2\left(\frac{x_-}{x_--y}\right)-\mathrm{Li}_2\left(\frac{x_+}{x_+-y}\right)
    +\mathrm{Li}_2\left(\frac{x_-}{y-x_+}\right)-\mathrm{Li}_2\left(\frac{x_+}{y-x_-}\right)
    \right.
    \\ \left.
    + \ln\left( \frac{-x_{-}}{x_{+}} \right) \ln\left ( 1 - i \varepsilon - \frac{v}{m^2}x_-x_+ \right )
    \right]\,,
  \end{multline}
  where
  \begin{equation}
    \label{eq:xpm}
    	x_{\pm} \equiv \frac{1}{2} \left ( 1 \pm \sqrt{1 + \frac{4m^2 u}{ts}} \right )
  \end{equation}
are real numbers, with $x_+>1$ and $x_-<-1$, and
\begin{equation}
  \label{eq:y-def}
  y \equiv \frac{1}{2} \left ( 1 + \sqrt{1 - \frac{4(m^2 - i \varepsilon)}{v}} \right ) \,,
\end{equation}
aquires an imaginary part according to the value of $v$. In particular, keeping track of the imaginary part of $y$ yields
\begin{equation}
  \label{eq:y-implementation}
y = \left\{
  \begin{split}
  \frac{1}{2}\left(1+\sqrt{1+\frac{4m^2}{|v|}}\right)-i\varepsilon\,,& \qquad v<0\\
  \frac{1}{2}\left(1+i\sqrt{\frac{4m^2}{v}-1}\right)\,,& \qquad 0<v<4 m^2\\
    \frac{1}{2}\left(1+\sqrt{1-\frac{4m^2}{v}}\right)+i\varepsilon\,,& \qquad v>4m^2
  \end{split}
  \right.
\end{equation}
From the above, we see that w for $0<v<4 m^2$ we can use the
dilogarithms as given by CHAPLIN.
%
For $v<0$, $x_-/(x_--y)$ and $x_+/(y-x_-)$ acquire a small positive
imaginary part, whereas $x_+/(x_+-y)$ and $x_-/(y-x_+)$ a small
negative imaginary part. The reverse happens for $v>4m^2$. Therefore,
we need to perform some formal manipulations to use the harmonic
polylogarithms provided by CHAPLIN.

In practice, whenever the argument $z$ of the dilogarithm is complex, we just use the
definitory relation $\mathrm{Li_2}(z)=H(0,1;z)$. When $z=x+i\varepsilon$, we use $\mathrm{Li_2}(x+i\varepsilon)=H(0,1;x)$, with $H(0,1;x)$ the complex number provided by CHAPLIN. If $z=x-i\varepsilon$, we use the identities
\begin{equation}
  \begin{split}
\mathrm{Li}_{2}\left ( x-i\varepsilon \right )&= -H\left(0,1;\frac{1}{x} \right ) - \frac{\pi^2}{6} - H(0,0; -x)  = -H(0,-1;-x) = \\ & 
= -H\left (0,1, 1-x \right )+ \frac{\pi^2}{6} + H(1;1-x) H(-1;-x)\,,
  \end{split}
\end{equation}
and we select the one that gives the smallest imaginary part. This of course give numerically indistinguishable results when the imaginary part is large, but is of
crucial importance when the imaginary part should be zero but it is
not because of the specific numerical methods employed by CHAPLIN.

Last, we adopt the implementation 
\begin{equation}
  \label{eq:log-implemented}
  \ln\left ( 1 - i \varepsilon - \frac{v}{m^2}x_-x_+ \right ) =H\left(1,\frac{v}{m^2}x_-x_+\right)\,,
\end{equation}
which keeps track of the correct imaginary part.

 
%as well as the property that for harmonic polylogarithms of weight $w = 2$ we have 
%\begin{align}
%	\mathrm{H}(0,1;x) &= \mathrm{Li}_{2}\left ( x \right ), \\ 
%	\mathrm{H}(0,-1;x) &= -\mathrm{Li}_{2}\left ( -x \right ). 
%\end{align} 

\bibliographystyle{plainurl}
\bibliography{h1jet.bib}

%\begin{thebibliography}{1}
%   \bibitem{h1jet} H1jet can be downloaded from: \\ \href{https://h1jet.hepforge.com}{https://h1jet.hepforge.com}
%   \bibitem{lhapdf} A.\ Buckley, J.\ Ferrando, S.\ Lloyd, K.\ Nordstrom, B.\ Page, M.\ Ruefenacht, M.\ Schoenherr, and G.\ Watt, \textit{LHAPDF6: parton density access in the LHC precision era}, Eur.\ Phys.\ J.\ \textbf{C75} (2015) 3, 132, [\href{https://arxiv.org/abs/1412.7420}{arXiv:1412.7420}]. 
%   \bibitem{hoppet} G.\ P.\ Salam and J.\ Rojo, \textit{A Higher Order Perturbative Parton Evolution Toolkit (HOPPET)}, Comput.\ Phys.\ Commun.\ \textbf{180} (2009) 120-156, [\href{https://arxiv.org/abs/0804.3755}{arXiv:0804.3755}]. 
%   \bibitem{chaplin} S.\ Buehler and C.\ Duhr, \textit{CHAPLIN - Complex Harmonic Polylogarithms in Fortran}, Comput.\ Phys.\ Commun.\ \textbf{185} (2014) 2703, [\href{https://arxiv.org/abs/1106.5739}{arXiv:1106.5739}]. 
%   \bibitem{alp} I.\ Brivio, M.\ B.\ Gavela, L.\ Merlo, K.\ Mimasu, J.\ M.\ No, R.\ del Rey, and V.\ Sanz, \textit{ALPs Effective Field Theory and Collider Signatures}, Eur.\ Phys.\ J.\ \textbf{C77} (2017) 572, [\href{https://arxiv.org/abs/1701.05379}{arXiv:1701.05379}]. The \textsc{FeynRules} model file is available here: \href{https://feynrules.irmp.ucl.ac.be/wiki/ALPsEFT}{https://feynrules.irmp.ucl.ac.be/wiki/ALPsEFT}. 
%\end{thebibliography}

\end{document}
